<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scrapbook Wrapped</title>

  <style>
    :root{
      --bg: #f7c7d9;

      --ink: rgba(25, 18, 22, 0.92);
      --muted: rgba(25, 18, 22, 0.62);
      --border: rgba(25, 18, 22, 0.14);

      --radius-lg: 18px;

      --ease: cubic-bezier(.22, 1, .36, 1);
      --t: 520ms;
    }

    *{ box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      overflow: hidden;
    }

    /* Optional soft wash so the background isn’t flat */
    .paperWash{
      pointer-events: none;
      position: fixed;
      inset: 0;
      background:
        radial-gradient(1200px 700px at 18% 10%, rgba(255,255,255,0.22), transparent 60%),
        radial-gradient(900px 700px at 85% 15%, rgba(255,255,255,0.16), transparent 55%),
        radial-gradient(700px 600px at 55% 90%, rgba(255,255,255,0.14), transparent 60%);
      mix-blend-mode: soft-light;
      opacity: 0.7;
    }

    /* FULL PAGE scrapbook */
    .scrapbook{
      position: relative;
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    .slides{
      position: absolute;
      inset: 0;
      overflow: hidden;
    }

    /* Page transitions */
    .page{
      position: absolute;
      inset: 0;
      padding: clamp(14px, 2.4vw, 28px);

      opacity: 0;
      transform: translateY(18px) scale(0.985);
      filter: blur(2px);
      pointer-events: none;

      transition:
        opacity var(--t) var(--ease),
        transform var(--t) var(--ease),
        filter var(--t) var(--ease);
    }
    .page.active{
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0);
      pointer-events: auto;
    }
    .page.exiting{
      opacity: 0;
      transform: translateY(-16px) scale(0.985);
      filter: blur(2px);
      pointer-events: none;
    }

    /* Title page */
    .titleCard{
      height: 100%;
      display: grid;
      place-items: center;
      text-align: center;
      padding: 18px;
    }
    .titleCard .big{
      font-size: clamp(34px, 5vw, 60px);
      font-weight: 950;
      letter-spacing: -1.4px;
      line-height: 1.02;
      margin: 0;
    }
    .titleCard .small{
      margin-top: 10px;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.5;
      max-width: 70ch;
    }
    .titleCard .startPill{
      margin-top: 18px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,0.50);
      border: 1px solid var(--border);
      color: rgba(25,18,22,0.86);
      font-weight: 850;
      font-size: 12px;
      user-select: none;
      backdrop-filter: blur(8px);
    }

    /* Boards grid */
    .boardGrid{
      height: 100%;
      min-height: 0;
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(12, 1fr);
      grid-auto-rows: 110px;
      align-content: start;
    }
    @media (max-width: 980px){ .boardGrid{ grid-auto-rows: 96px; } }
    @media (max-width: 760px){ .boardGrid{ grid-auto-rows: 88px; } }

    .board{
      grid-column: span 6;
      grid-row: span 3;
      position: relative;
      border-radius: var(--radius-lg);
      overflow: hidden;
      border: 1px solid rgba(25, 18, 22, 0.12);
      background: rgba(255,255,255,0.22);
      cursor: zoom-in;

      transform: translateZ(0);
      transition: transform 180ms ease, box-shadow 180ms ease, border-color 180ms ease;
    }
    .board:hover{
      transform: translateY(-2px);
      box-shadow: 0 18px 46px rgba(0,0,0,0.18);
      border-color: rgba(25, 18, 22, 0.20);
    }

    /* Size variants */
    .w4{ grid-column: span 4; }
    .w5{ grid-column: span 5; }
    .w6{ grid-column: span 6; }
    .w7{ grid-column: span 7; }
    .w8{ grid-column: span 8; }
    .h3{ grid-row: span 3; }
    .h4{ grid-row: span 4; }
    .h5{ grid-row: span 5; }

    @media (max-width: 760px){
      .board{ grid-column: span 12 !important; grid-row: span 4 !important; }
    }

    .board img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .board .tag{
      position: absolute;
      left: 10px;
      bottom: 10px;
      font-size: 12px;
      font-weight: 800;
      letter-spacing: -0.2px;
      color: rgba(25,18,22,0.92);
      background: rgba(255,255,255,0.70);
      border: 1px solid rgba(25, 18, 22, 0.10);
      padding: 7px 10px;
      border-radius: 999px;
      backdrop-filter: blur(8px);
      user-select: none;
    }

    /* Left/Right arrows */
    .navArrow{
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      width: 46px;
      height: 46px;
      border-radius: 999px;
      border: 1px solid rgba(25, 18, 22, 0.18);
      background: rgba(255,255,255,0.58);
      box-shadow: 0 14px 34px rgba(0,0,0,0.14);
      display: grid;
      place-items: center;
      cursor: pointer;
      user-select: none;
      z-index: 50;
      transition: transform 150ms ease, background 150ms ease, border-color 150ms ease, opacity 150ms ease;
    }
    .navArrow:hover{
      background: rgba(255,255,255,0.74);
      border-color: rgba(25, 18, 22, 0.24);
      transform: translateY(-50%) scale(1.03);
    }
    .navArrow:active{
      transform: translateY(-50%) scale(0.99);
    }
    .navArrow.left{ left: 14px; }
    .navArrow.right{ right: 14px; }
    .navArrow[disabled]{
      opacity: 0.35;
      cursor: default;
      pointer-events: none;
    }
    .navArrow svg{
      width: 20px;
      height: 20px;
      fill: none;
      stroke: rgba(25,18,22,0.88);
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    /* =========================
       Tweets section (NO rounded rectangle background)
       ========================= */
    .tweetSection{
      position: relative;
      height: 100%;
      width: 100%;
      display: grid;
      place-items: center;
      padding: clamp(12px, 2vw, 26px);
    }

    /* Intro text */
    .tweetIntro{
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 420ms var(--ease);
      z-index: 5;
    }
    .tweetIntro.show{ opacity: 1; }
    .tweetIntro .box{
      background: rgba(255,255,255,0.60);
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
      border-radius: 999px;
      padding: 14px 18px;
      font-weight: 900;
      letter-spacing: -0.4px;
      font-size: 16px;
      color: rgba(25,18,22,0.90);
      box-shadow: 0 18px 48px rgba(0,0,0,0.14);
      text-transform: lowercase;
    }

    /* Dim rest of screen while tweet is highlighted */
    .tweetDim{
      position: absolute;
      inset: 0;
      opacity: 0;
      pointer-events: none;
      transition: opacity 380ms ease;
      z-index: 1;
    }
    .tweetDim.on{
      opacity: 1;
      background: rgba(0,0,0,0.18);
    }

    /* Stage for single tweet viewing */
    .tweetStage{
      width: min(980px, 100%);
      height: min(760px, calc(100vh - 120px));
      display: grid;
      place-items: center;
      position: relative;
      z-index: 2;
      pointer-events: none;
    }
    .tweetStage.on{ pointer-events: auto; }

    /* We show the entire image: object-fit: contain */
    .tweetCard{
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(255,255,255,0.06);
      box-shadow: 0 34px 90px rgba(0,0,0,0.30);
      display: grid;
      place-items: center;

      opacity: 0;
      transform: translateX(40px) scale(0.98);
      filter: blur(2px);
      transition:
        opacity 520ms var(--ease),
        transform 520ms var(--ease),
        filter 520ms var(--ease);
    }
    .tweetCard.active{
      opacity: 1;
      transform: translateX(0) scale(1);
      filter: blur(0);
    }

    /* Leaving card shrinks and “joins the background” */
    .tweetCard.shrinkAway{
      opacity: 1;
      transform: translateX(-40px) scale(0.28) rotate(-2deg);
      filter: blur(0.5px);
      box-shadow: 0 18px 40px rgba(0,0,0,0.18);
    }

    .tweetCard img{
      width: 100%;
      height: 100%;
      object-fit: contain; /* IMPORTANT: show full tweet */
      display: block;
      background: rgba(0,0,0,0.05);
    }

    .tweetHint{
      position: absolute;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: rgba(25,18,22,0.62);
      background: rgba(255,255,255,0.46);
      border: 1px solid rgba(25,18,22,0.12);
      padding: 8px 10px;
      border-radius: 999px;
      backdrop-filter: blur(8px);
      user-select: none;
      z-index: 4;
      opacity: 0;
      transition: opacity 320ms ease;
      pointer-events: none;
    }
    .tweetHint.on{ opacity: 1; }

    /* Collage view after last tweet */
    .tweetCollage{
      width: 100%;
      height: 100%;
      position: relative;
      z-index: 2;
      opacity: 0;
      transform: scale(0.985);
      filter: blur(1px);
      pointer-events: none;
      transition: opacity 520ms var(--ease), transform 520ms var(--ease), filter 520ms var(--ease);
    }
    .tweetCollage.on{
      opacity: 1;
      transform: scale(1);
      filter: blur(0);
      pointer-events: auto;
    }

    .tweetCollageGrid{
      height: 100%;
      width: 100%;
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(12, 1fr);
      grid-auto-rows: 120px;
      align-content: start;
    }
    @media (max-width: 980px){ .tweetCollageGrid{ grid-auto-rows: 105px; } }
    @media (max-width: 760px){ .tweetCollageGrid{ grid-auto-rows: 96px; } }

    .tweetThumb{
      grid-column: span 6;
      grid-row: span 3;
      border-radius: var(--radius-lg);
      overflow: hidden;
      border: 1px solid rgba(25,18,22,0.14);
      background: rgba(255,255,255,0.20);
      box-shadow: 0 16px 36px rgba(0,0,0,0.16);
      cursor: zoom-in;
      transition: transform 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
    }
    .tweetThumb:hover{
      transform: translateY(-2px);
      box-shadow: 0 22px 46px rgba(0,0,0,0.20);
      border-color: rgba(25,18,22,0.22);
    }
    .tweetThumb img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* Make collage feel scrapbook-y: varied sizes */
    .tw_w4{ grid-column: span 4; }
    .tw_w5{ grid-column: span 5; }
    .tw_w7{ grid-column: span 7; }
    .tw_w8{ grid-column: span 8; }
    .tw_h3{ grid-row: span 3; }
    .tw_h4{ grid-row: span 4; }
    .tw_h5{ grid-row: span 5; }

    @media (max-width: 760px){
      .tweetThumb{ grid-column: span 12 !important; grid-row: span 4 !important; }
    }

    .collageHint{
      position: absolute;
      top: 16px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: rgba(25,18,22,0.62);
      background: rgba(255,255,255,0.46);
      border: 1px solid rgba(25,18,22,0.12);
      padding: 8px 10px;
      border-radius: 999px;
      backdrop-filter: blur(8px);
      user-select: none;
      z-index: 4;
      opacity: 0;
      transition: opacity 320ms ease;
      pointer-events: none;
    }
    .collageHint.on{ opacity: 1; }

    /* Zoom overlay */
    .overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.00);
      opacity: 0;
      pointer-events: none;
      transition: opacity 260ms ease, background 260ms ease;
      z-index: 1000;
    }
    .overlay.open{
      opacity: 1;
      pointer-events: auto;
      background: rgba(0,0,0,0.10);
    }

    .zoomImg{
      position: fixed;
      z-index: 1001;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 34px 90px rgba(0,0,0,0.30);
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);

      will-change: transform, width, height, top, left;
      transition:
        top 520ms var(--ease),
        left 520ms var(--ease),
        width 520ms var(--ease),
        height 520ms var(--ease),
        transform 520ms var(--ease);
      cursor: zoom-out;
    }
    .zoomImg img{
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      background: rgba(0,0,0,0.06);
    }
  </style>
</head>

<body>
  <div class="paperWash"></div>

  <main class="scrapbook">
    <div class="slides" id="slides">

      <!-- PAGE 1: Title -->
      <section class="page active" data-page="cover">
        <div class="titleCard">
          <div>
            <h1 class="big" contenteditable="true">2025<br/>Wrapped</h1>
            <div class="small" contenteditable="true">
              Click any board to zoom in.<br/>
              Use the arrows (or ← → keys) to turn pages.
            </div>
            <div class="startPill" contenteditable="true">Next →</div>
          </div>
        </div>
      </section>

      <!-- PAGE 2: Style boards -->
      <section class="page" data-page="boards-style">
        <div class="boardGrid">
          <figure class="board w7 h5" data-src="assets/ZeeNYBoardVogue.png">
            <img src="assets/ZeeNYBoardVogue.png" alt="Board: Vogue" />
            <figcaption class="tag" contenteditable="true">EN NOIR</figcaption>
          </figure>

          <figure class="board w5 h5" data-src="assets/ZeeNYBoardBurgundy.png">
            <img src="assets/ZeeNYBoardBurgundy.png" alt="Board: Burgundy" />
            <figcaption class="tag" contenteditable="true">UNE QUESTION DE GOÛT</figcaption>
          </figure>
        </div>
      </section>

      <!-- PAGE 3: Good times + coquette -->
      <section class="page" data-page="boards-good">
        <div class="boardGrid">
          <figure class="board w8 h5" data-src="assets/ZeeNYBoardGoodTimes.png">
            <img src="assets/ZeeNYBoardGoodTimes.png" alt="Board: The good times" />
            <figcaption class="tag" contenteditable="true">THE GOOD TIMES :)</figcaption>
          </figure>

          <figure class="board w4 h5" data-src="assets/ZeeNYBoardCoquette.png">
            <img src="assets/ZeeNYBoardCoquette.png" alt="Board: La vie en rose" />
            <figcaption class="tag" contenteditable="true">LA VIE EN ROSE</figcaption>
          </figure>
        </div>
      </section>

      <!-- PAGE 4: Tweets -->
      <section class="page" data-page="tweets">
        <div class="tweetSection" id="tweetSection">

          <div class="tweetDim" id="tweetDim"></div>

          <div class="tweetIntro" id="tweetIntro">
            <div class="box">top tweets this year</div>
          </div>

          <!-- Single-tweet stage -->
          <div class="tweetStage" id="tweetStage" aria-hidden="true"></div>

          <!-- Collage stage -->
          <div class="tweetCollage" id="tweetCollage" aria-hidden="true">
            <div class="collageHint" id="collageHint">click a tweet to zoom • → continues</div>
            <div class="tweetCollageGrid" id="tweetCollageGrid"></div>
          </div>

          <div class="tweetHint" id="tweetHint">← → to scroll • last → shows scrapbook</div>
        </div>
      </section>

      <!-- PAGE 5: End -->
      <section class="page" data-page="end">
        <div class="titleCard">
          <div>
            <h1 class="big" contenteditable="true">End of file.</h1>
            <div class="small" contenteditable="true">
              Add a final one-liner here.<br/>
              Optional: “Open anytime.”
            </div>
            <div class="startPill" contenteditable="true">← Back</div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- Left/Right arrows for navigation -->
  <button class="navArrow left" id="leftArrow" aria-label="Previous">
    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M15 18l-6-6 6-6"/></svg>
  </button>

  <button class="navArrow right" id="rightArrow" aria-label="Next">
    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M9 6l6 6-6 6"/></svg>
  </button>

  <!-- Zoom overlay -->
  <div class="overlay" id="overlay" aria-hidden="true"></div>

  <script>
    // =========================
    // Page navigation
    // =========================
    const pages = Array.from(document.querySelectorAll('.page'));
    const totalPages = pages.length;
    let pageIdx = 0;
    let pageAnimating = false;

    // Tweet UI needs to intercept arrows while on that page
    let navLocked = false; // locks nav during intro unless user clicks left/right rules apply

    const leftArrow = document.getElementById('leftArrow');
    const rightArrow = document.getElementById('rightArrow');

    function currentPageKey(){
      return pages[pageIdx]?.dataset?.page || '';
    }

    function updateArrowDisabled(){
      // During tweet intro, arrows should still work (special behavior),
      // so we don't hard-disable them here.
      if(currentPageKey() === 'tweets'){
        // tweet controller sets these
        return;
      }
      leftArrow.toggleAttribute('disabled', pageIdx === 0);
      rightArrow.toggleAttribute('disabled', pageIdx === totalPages - 1);
    }

    function goToPage(next){
      if(pageAnimating) return;
      if(next === pageIdx) return;
      if(next < 0 || next >= totalPages) return;

      pageAnimating = true;
      const current = pages[pageIdx];
      const incoming = pages[next];

      if(current?.dataset?.page === 'tweets'){
        tweetReset();
      }

      current.classList.remove('active');
      current.classList.add('exiting');
      incoming.classList.add('active');

      window.setTimeout(() => {
        current.classList.remove('exiting');
        pageIdx = next;
        pageAnimating = false;

        if(incoming?.dataset?.page === 'tweets'){
          tweetEnter();
        }else{
          updateArrowDisabled();
        }
      }, 560);
    }

    function nextPage(){ goToPage(Math.min(totalPages - 1, pageIdx + 1)); }
    function prevPage(){ goToPage(Math.max(0, pageIdx - 1)); }

    // =========================
    // Tweets controller
    // =========================
    const tweetIntro = document.getElementById('tweetIntro');
    const tweetStage = document.getElementById('tweetStage');
    const tweetDim = document.getElementById('tweetDim');
    const tweetHint = document.getElementById('tweetHint');

    const tweetCollage = document.getElementById('tweetCollage');
    const tweetCollageGrid = document.getElementById('tweetCollageGrid');
    const collageHint = document.getElementById('collageHint');

    const tweets = [
      "assets/ZeeNYTweet1.png",
      "assets/ZeeNYTweet2.png",
      "assets/ZeeNYTweet3.png",
      "assets/ZeeNYTweet4.png",
      "assets/ZeeNYTweet5.png",
      "assets/ZeeNYTweet6.png",
      "assets/ZeeNYTweet7.png",
      "assets/ZeeNYTweet8.png",
    ];

    // Modes inside tweet page:
    // - "intro" (3s) -> user can left=prev page, right=skip to tweets
    // - "carousel" (single tweet with transitions)
    // - "collage" (all 8 shown)
    let tweetMode = "idle";
    let tweetIdx = 0;
    let tweetTimers = [];
    let tweetAnimating = false;

    function clearTweetTimers(){
      tweetTimers.forEach(t => clearTimeout(t));
      tweetTimers = [];
    }

    function tweetSetArrowState(){
      // Always keep arrows enabled on tweet page; behavior is contextual.
      leftArrow.toggleAttribute('disabled', false);
      rightArrow.toggleAttribute('disabled', false);
    }

    function tweetReset(){
      clearTweetTimers();
      navLocked = false;
      tweetMode = "idle";
      tweetIdx = 0;
      tweetAnimating = false;

      tweetIntro.classList.remove('show');
      tweetStage.innerHTML = "";
      tweetStage.classList.remove('on');
      tweetStage.setAttribute('aria-hidden','true');

      tweetDim.classList.remove('on');
      tweetHint.classList.remove('on');

      tweetCollage.classList.remove('on');
      tweetCollage.setAttribute('aria-hidden','true');
      collageHint.classList.remove('on');
      tweetCollageGrid.innerHTML = "";

      updateArrowDisabled();
    }

    function buildTweetCard(src){
      const card = document.createElement('div');
      card.className = 'tweetCard';
      card.innerHTML = `<img src="${src}" alt="Top tweet" />`;
      return card;
    }

    function showTweetCarousel(startIndex = 0, {instant=false} = {}){
      tweetMode = "carousel";
      tweetIdx = Math.max(0, Math.min(tweets.length - 1, startIndex));
      tweetStage.classList.add('on');
      tweetStage.setAttribute('aria-hidden','false');

      tweetCollage.classList.remove('on');
      tweetCollage.setAttribute('aria-hidden','true');
      collageHint.classList.remove('on');

      tweetDim.classList.add('on');
      tweetHint.classList.add('on');

      tweetSetArrowState();

      // clear stage and mount current card
      tweetStage.innerHTML = "";
      const card = buildTweetCard(tweets[tweetIdx]);
      tweetStage.appendChild(card);

      if(instant){
        // no slide-in on first render
        card.classList.add('active');
      }else{
        requestAnimationFrame(()=> card.classList.add('active'));
      }
    }

    function animateToTweet(nextIndex){
      if(tweetAnimating) return;
      if(tweetMode !== "carousel") return;

      const clamped = Math.max(0, Math.min(tweets.length - 1, nextIndex));
      if(clamped === tweetIdx) return;

      tweetAnimating = true;

      const oldCard = tweetStage.querySelector('.tweetCard');
      const newCard = buildTweetCard(tweets[clamped]);
      // New tweet starts off-screen right; becomes active to slide in
      tweetStage.appendChild(newCard);

      // Force reflow so transitions apply
      void newCard.offsetWidth;

      // Start animation:
      // - old shrinks away into background
      // - new slides in over it
      oldCard.classList.remove('active');
      oldCard.classList.add('shrinkAway');

      requestAnimationFrame(() => {
        newCard.classList.add('active');
      });

      // Cleanup after transition
      setTimeout(() => {
        oldCard.remove();
        tweetIdx = clamped;
        tweetAnimating = false;
      }, 560);
    }

    function showTweetCollage(){
      tweetMode = "collage";
      tweetAnimating = false;

      // Keep a faint dim to feel like spotlight is gone? We'll turn off dim
      tweetDim.classList.remove('on');
      tweetHint.classList.remove('on');

      tweetStage.classList.remove('on');
      tweetStage.setAttribute('aria-hidden','true');
      tweetStage.innerHTML = "";

      tweetCollageGrid.innerHTML = "";

      // Scrappy layout: pick some varied spans
      const layout = [
        {w:'tw_w7', h:'tw_h5'},
        {w:'tw_w5', h:'tw_h5'},
        {w:'tw_w4', h:'tw_h4'},
        {w:'tw_w8', h:'tw_h4'},
        {w:'tw_w6', h:'tw_h4'},
        {w:'tw_w6', h:'tw_h3'},
        {w:'tw_w5', h:'tw_h3'},
        {w:'tw_w7', h:'tw_h3'},
      ];

      tweets.forEach((src, i) => {
        const item = document.createElement('div');
        const l = layout[i] || {w:'tw_w6', h:'tw_h4'};
        item.className = `tweetThumb ${l.w} ${l.h}`;
        item.dataset.src = src;
        item.innerHTML = `<img src="${src}" alt="Tweet ${i+1}" />`;
        item.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          // Zoom to view one (reuse overlay zoom)
          openZoomFromElement(item.querySelector('img'), src);
        });
        tweetCollageGrid.appendChild(item);
      });

      tweetCollage.classList.add('on');
      tweetCollage.setAttribute('aria-hidden','false');
      collageHint.classList.add('on');

      tweetSetArrowState();
    }

    function tweetEnter(){
      tweetReset();
      tweetMode = "intro";
      navLocked = true;

      tweetSetArrowState();

      // Show intro immediately
      tweetIntro.classList.add('show');

      // Auto proceed after 3s
      tweetTimers.push(setTimeout(() => {
        // fade out intro, then show carousel
        tweetIntro.classList.remove('show');
        tweetMode = "carousel";
        navLocked = false;

        // small delay so fade-out feels clean
        setTimeout(() => {
          showTweetCarousel(0, {instant:false});
        }, 220);
      }, 3000));
    }

    function tweetSkipIntroToCarousel(){
      if(tweetMode !== "intro") return;
      clearTweetTimers();
      tweetIntro.classList.remove('show');
      tweetMode = "carousel";
      navLocked = false;
      showTweetCarousel(0, {instant:true});
    }

    function tweetPrev(){
      if(tweetMode === "intro"){
        // left while text is shown -> previous section
        clearTweetTimers();
        tweetIntro.classList.remove('show');
        navLocked = false;
        prevPage();
        return;
      }

      if(tweetMode === "carousel"){
        if(tweetIdx === 0){
          // go to previous section
          prevPage();
        }else{
          animateToTweet(tweetIdx - 1);
        }
        return;
      }

      if(tweetMode === "collage"){
        // from collage, left goes back to carousel last tweet (feels natural)
        showTweetCarousel(tweets.length - 1, {instant:true});
        return;
      }
    }

    function tweetNext(){
      if(tweetMode === "intro"){
        // right while text is shown -> skip cooldown and go to tweets
        tweetSkipIntroToCarousel();
        return;
      }

      if(tweetMode === "carousel"){
        if(tweetIdx === tweets.length - 1){
          // last tweet: right closes out and shows all 8 in scrapbook format
          showTweetCollage();
        }else{
          animateToTweet(tweetIdx + 1);
        }
        return;
      }

      if(tweetMode === "collage"){
        // right again advances to next section
        nextPage();
        return;
      }
    }

    // =========================
    // Arrow handlers (context-aware)
    // =========================
    leftArrow.addEventListener('click', () => {
      if(currentPageKey() === 'tweets') tweetPrev();
      else prevPage();
    });

    rightArrow.addEventListener('click', () => {
      if(currentPageKey() === 'tweets') tweetNext();
      else nextPage();
    });

    window.addEventListener('keydown', (e) => {
      const a = document.activeElement;
      const tag = (a && a.tagName ? a.tagName.toLowerCase() : '');
      if(tag === 'textarea') return;

      if(e.key === 'ArrowRight' || e.key === 'PageDown'){
        if(currentPageKey() === 'tweets') tweetNext();
        else nextPage();
      }
      if(e.key === 'ArrowLeft' || e.key === 'PageUp'){
        if(currentPageKey() === 'tweets') tweetPrev();
        else prevPage();
      }
      if(e.key === 'Home') goToPage(0);
      if(e.key === 'End') goToPage(totalPages - 1);
    });

    updateArrowDisabled();

    // =========================
    // Board zoom (reused for boards + collage)
    // =========================
    const overlay = document.getElementById('overlay');
    let zoomEl = null;
    let zoomFromRect = null;
    let zoomOpen = false;

    function openZoomFromElement(imgEl, srcOverride=null){
      if(zoomOpen) return;

      const src = srcOverride || imgEl.src;
      const rect = imgEl.getBoundingClientRect();
      zoomFromRect = rect;

      zoomEl = document.createElement('div');
      zoomEl.className = 'zoomImg';
      zoomEl.style.top = rect.top + 'px';
      zoomEl.style.left = rect.left + 'px';
      zoomEl.style.width = rect.width + 'px';
      zoomEl.style.height = rect.height + 'px';
      zoomEl.style.transform = 'translateZ(0)';
      zoomEl.innerHTML = `<img src="${src}" alt="Zoomed item" />`;
      document.body.appendChild(zoomEl);

      overlay.classList.add('open');
      overlay.setAttribute('aria-hidden','false');
      zoomOpen = true;

      const pad = 34;
      const vw = window.innerWidth;
      const vh = window.innerHeight;
      const maxW = vw - pad * 2;
      const maxH = vh - pad * 2;

      // compute target based on natural ratio after load
      const zimg = zoomEl.querySelector('img');

      function place(ratio){
        let ww = Math.min(maxW, maxH * ratio);
        let hh = ww / ratio;
        if(hh > maxH){ hh = maxH; ww = hh * ratio; }
        const tt = (vh - hh) / 2;
        const ll = (vw - ww) / 2;
        zoomEl.style.top = tt + 'px';
        zoomEl.style.left = ll + 'px';
        zoomEl.style.width = ww + 'px';
        zoomEl.style.height = hh + 'px';
      }

      // initial guess
      const ratioGuess = rect.width / rect.height;
      requestAnimationFrame(() => place(ratioGuess));

      zimg.addEventListener('load', () => {
        const ir = zimg.naturalWidth / zimg.naturalHeight;
        place(ir);
      }, { once: true });

      zoomEl.addEventListener('click', closeZoom);
    }

    function closeZoom(){
      if(!zoomOpen || !zoomEl || !zoomFromRect) return;

      overlay.classList.remove('open');
      overlay.setAttribute('aria-hidden','true');

      zoomEl.style.top = zoomFromRect.top + 'px';
      zoomEl.style.left = zoomFromRect.left + 'px';
      zoomEl.style.width = zoomFromRect.width + 'px';
      zoomEl.style.height = zoomFromRect.height + 'px';

      window.setTimeout(() => {
        if(zoomEl){
          zoomEl.remove();
          zoomEl = null;
        }
        zoomOpen = false;
        zoomFromRect = null;
      }, 560);
    }

    overlay.addEventListener('click', closeZoom);
    window.addEventListener('keydown', (e) => {
      if(e.key === 'Escape') closeZoom();
    });

    document.querySelectorAll('.board img').forEach(img => {
      img.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        openZoomFromElement(img);
      });
    });

    window.addEventListener('resize', () => {
      if(zoomOpen) closeZoom();
    });

    // =========================
    // Enter hook for tweets page
    // =========================
    // Patch goToPage to call tweetEnter when landing on tweets
    // (already handled in goToPage), but initial load:
    if(currentPageKey() === 'tweets') tweetEnter();
  </script>
</body>
</html>
